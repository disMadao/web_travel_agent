# Supabase è®¤è¯é…ç½®æŒ‡å—

## é—®é¢˜ï¼šæ³¨å†Œæ—¶æŠ¥é”™ç¼ºå°‘ access_token

### åŸå› 
Supabase é»˜è®¤å¼€å¯äº†é‚®ç®±éªŒè¯ï¼ˆEmail Confirmationï¼‰ï¼Œæ³¨å†Œåä¸ä¼šç«‹å³è¿”å› sessionï¼Œè€Œæ˜¯è¦æ±‚ç”¨æˆ·å…ˆéªŒè¯é‚®ç®±ã€‚

### è§£å†³æ–¹æ¡ˆ

---

## æ–¹æ¡ˆ 1ï¼šå…³é—­é‚®ç®±éªŒè¯ï¼ˆå¼€å‘ç¯å¢ƒæ¨èï¼‰â­

### æ­¥éª¤ï¼š

1. **ç™»å½• Supabase**
   - è®¿é—® https://supabase.com
   - é€‰æ‹©ä½ çš„é¡¹ç›®

2. **è¿›å…¥è®¤è¯è®¾ç½®**
   - å·¦ä¾§èœå•ï¼š**Authentication** â†’ **Settings**

3. **æ‰¾åˆ° Email Auth é…ç½®**
   - å‘ä¸‹æ»šåŠ¨åˆ° **Email Auth** éƒ¨åˆ†

4. **å…³é—­é‚®ç®±ç¡®è®¤**
   - æ‰¾åˆ° `Enable email confirmations`
   - **å–æ¶ˆå‹¾é€‰**ï¼ˆå…³é—­ï¼‰
   - ç‚¹å‡» **Save** ä¿å­˜

5. **é‡å¯åç«¯**
   ```bash
   # åœæ­¢åç«¯ï¼ˆCtrl+Cï¼‰
   # é‡æ–°å¯åŠ¨
   python main.py
   ```

### æ•ˆæœï¼š
âœ… æ³¨å†Œåç«‹å³è¿”å› access_token
âœ… æ— éœ€éªŒè¯é‚®ç®±å³å¯ç™»å½•
âœ… é€‚åˆå¼€å‘å’Œæµ‹è¯•

### ç¼ºç‚¹ï¼š
âš ï¸ ä»»ä½•äººéƒ½èƒ½æ³¨å†Œï¼ˆæ²¡æœ‰é‚®ç®±éªŒè¯ï¼‰
âš ï¸ ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ

---

## æ–¹æ¡ˆ 2ï¼šé…ç½®é‚®ä»¶æœåŠ¡ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

å¦‚æœä½ æƒ³ä¿ç•™é‚®ç®±éªŒè¯åŠŸèƒ½ï¼ˆæ›´å®‰å…¨ï¼‰ï¼š

### æ­¥éª¤ï¼š

1. **é…ç½® SMTP æœåŠ¡**
   - Authentication â†’ Settings â†’ Email Auth
   - æ‰¾åˆ° **SMTP Settings**
   - é…ç½®ä½ çš„é‚®ä»¶æœåŠ¡å™¨ï¼ˆå¦‚ Gmailã€SendGridã€é˜¿é‡Œäº‘é‚®ä»¶ç­‰ï¼‰

2. **Gmail ç¤ºä¾‹é…ç½®**
   ```
   SMTP Host: smtp.gmail.com
   SMTP Port: 587
   SMTP User: your-email@gmail.com
   SMTP Password: your-app-password
   From Email: your-email@gmail.com
   ```

3. **è‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿**
   - Authentication â†’ Email Templates
   - è‡ªå®šä¹‰ **Confirm signup** æ¨¡æ¿

4. **æ³¨å†Œæµç¨‹**
   ```
   ç”¨æˆ·æ³¨å†Œ
     â†“
   æ”¶åˆ°ç¡®è®¤é‚®ä»¶
     â†“
   ç‚¹å‡»é“¾æ¥éªŒè¯
     â†“
   å¯ä»¥ç™»å½•
   ```

### Gmail é…ç½®è¯´æ˜ï¼š
- éœ€è¦å¼€å¯ **ä¸¤æ­¥éªŒè¯**
- ç”Ÿæˆ **åº”ç”¨ä¸“ç”¨å¯†ç **
- è¯¦è§ï¼šhttps://support.google.com/accounts/answer/185833

---

## æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ Magic Linkï¼ˆæ¨èï¼‰

æ— å¯†ç ç™»å½•ï¼Œæ›´å®‰å…¨ï¼š

### æ­¥éª¤ï¼š

1. **å¯ç”¨ Magic Link**
   - Authentication â†’ Settings
   - å¼€å¯ `Enable email-based Magic Link`

2. **ä¿®æ”¹å‰ç«¯ä»£ç **
   ```typescript
   // å‘é€ Magic Link
   const { error } = await supabase.auth.signInWithOtp({
     email: 'user@example.com'
   })
   ```

3. **ç”¨æˆ·ä½“éªŒ**
   ```
   è¾“å…¥é‚®ç®±
     â†“
   æ”¶åˆ°ç™»å½•é“¾æ¥
     â†“
   ç‚¹å‡»é“¾æ¥
     â†“
   è‡ªåŠ¨ç™»å½•
   ```

---

## å¼€å‘ç¯å¢ƒå¿«é€Ÿé…ç½® ğŸš€

**æœ€ç®€å•çš„æ–¹å¼ï¼ˆç”¨äºå­¦ä¹ å’Œå¼€å‘ï¼‰**ï¼š

1. è®¿é—® Supabase Dashboard
2. Authentication â†’ Settings â†’ Email Auth
3. **å…³é—­ä»¥ä¸‹é€‰é¡¹**ï¼š
   - âŒ Enable email confirmations
   - âŒ Enable email change confirmations
   - âŒ Secure email change

4. ä¿å­˜å¹¶é‡å¯åç«¯

**ç°åœ¨å¯ä»¥ç›´æ¥æ³¨å†Œç™»å½•ï¼Œæ— éœ€éªŒè¯ï¼**

---

## ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®® ğŸ”’

**æ¨èé…ç½®**ï¼š

1. âœ… ä¿æŒé‚®ç®±éªŒè¯å¼€å¯
2. âœ… é…ç½®å¯é çš„ SMTP æœåŠ¡
3. âœ… è‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿ï¼ˆå“ç‰ŒåŒ–ï¼‰
4. âœ… è®¾ç½®é‚®ä»¶å‘é€é¢‘ç‡é™åˆ¶
5. âœ… å¼€å¯åƒåœ¾é‚®ä»¶é˜²æŠ¤

**SMTP æœåŠ¡æ¨è**ï¼š
- **SendGrid**ï¼ˆå…è´¹æ¯æ—¥100å°ï¼‰
- **Mailgun**ï¼ˆå…è´¹æ¯æœˆ5000å°ï¼‰
- **Amazon SES**ï¼ˆä»˜è´¹ï¼Œä¾¿å®œï¼‰
- **é˜¿é‡Œäº‘é‚®ä»¶æ¨é€**ï¼ˆå›½å†…ï¼‰

---

## å¸¸è§é—®é¢˜

### Q: æ³¨å†ŒåæŠ¥é”™ "ç¼ºå°‘ access_token"

**A**: å¼€å¯äº†é‚®ç®±éªŒè¯ä½†æ²¡é…ç½®é‚®ä»¶æœåŠ¡ã€‚

**è§£å†³**ï¼š
- æ–¹æ³•1ï¼šå…³é—­é‚®ç®±éªŒè¯
- æ–¹æ³•2ï¼šé…ç½® SMTP æœåŠ¡

### Q: æ”¶ä¸åˆ°ç¡®è®¤é‚®ä»¶ï¼Ÿ

**A**: SMTP é…ç½®é”™è¯¯æˆ–é‚®ä»¶è¢«æ‹¦æˆªã€‚

**æ£€æŸ¥**ï¼š
1. SMTP è®¾ç½®æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹
3. æŸ¥çœ‹ Supabase Logs

### Q: å¦‚ä½•é‡æ–°å‘é€ç¡®è®¤é‚®ä»¶ï¼Ÿ

**A**: è°ƒç”¨ APIï¼š
```python
supabase.auth.resend({
    "type": "signup",
    "email": "user@example.com"
})
```

### Q: å¯ä»¥è‡ªå®šä¹‰é‚®ä»¶å†…å®¹å—ï¼Ÿ

**A**: å¯ä»¥ï¼
- Authentication â†’ Email Templates
- ç¼–è¾‘ HTML æ¨¡æ¿
- æ”¯æŒå˜é‡ï¼š{{ .Token }}, {{ .Email }} ç­‰

---

## æµ‹è¯•é…ç½®

### æµ‹è¯•æ³¨å†Œæµç¨‹ï¼š

```bash
# æµ‹è¯•æ³¨å†Œ API
curl -X POST http://localhost:8000/api/v1/auth/signup \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123"
  }'
```

**æˆåŠŸå“åº”**ï¼ˆå…³é—­é‚®ç®±éªŒè¯åï¼‰ï¼š
```json
{
  "access_token": "eyJhbGci...",
  "refresh_token": "...",
  "user": {
    "id": "...",
    "email": "test@example.com"
  }
}
```

**éœ€è¦éªŒè¯å“åº”**ï¼ˆå¼€å¯é‚®ç®±éªŒè¯æ—¶ï¼‰ï¼š
```json
{
  "detail": "æ³¨å†ŒæˆåŠŸï¼è¯·æ£€æŸ¥é‚®ç®±å¹¶ç‚¹å‡»ç¡®è®¤é“¾æ¥åå†ç™»å½•ã€‚"
}
```

---

## æ€»ç»“

| ç¯å¢ƒ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|------|----------|------|
| æœ¬åœ°å¼€å‘ | å…³é—­é‚®ç®±éªŒè¯ | å¿«é€Ÿæµ‹è¯• |
| æµ‹è¯•ç¯å¢ƒ | Magic Link | æ— éœ€å¯†ç  |
| ç”Ÿäº§ç¯å¢ƒ | SMTP + é‚®ç®±éªŒè¯ | æœ€å®‰å…¨ |

ç°åœ¨å» Supabase Dashboard ä¿®æ”¹é…ç½®å§ï¼ğŸ‰

